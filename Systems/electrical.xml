<?xml version="1.0" encoding="UTF-8"?>
<!--
	Electrical system for the P210N, by TheEagle, started in March 2022
	
	Technical data:
		Battery:
			Capacity: 12.75 Ah
			Voltage: 24 V
			Current: 60 (?) A
			Type: Lead-acid
		Alternator:
			Voltage: 28 V
			Current: 60 A
		Ground power:
			Voltage: 24 V
			Current 60 (?) A
		System:
			Voltage: 28 V
			Current: 60 A
			Type: Direct current
	
	TODO: a lot, mainly:
		* model over current (too high amps load decreases voltage and potentially damages the power supplier if it lasts too long)
-->
<PropertyList>
	<filter>
		<name>Calculate dt</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<expression>
				<dif>
					<property>/sim/time/elapsed-sec</property>
					<property>/systems/electrical/last-exec-time</property>
				</dif>
			</expression>
		</input>
		<output>/systems/electrical/dt</output>
	</filter>
	<filter>
		<name>Save current elapsed-sec for next iteration</name>
		<type>gain</type>
		<gain>1</gain>
		<input>/sim/time/elapsed-sec</input>
		<output>/systems/electrical/last-exec-time</output>
	</filter>
	
	<!-- First, every supplier calculates it's avilable voltage and current -->
	<!-- Alternator -->
	<filter>
		<name>Available alternator amps</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<condition>
				<greater-than-equals>
					<property>/engines/engine/rpm</property>
					<value>166</value>
				</greater-than-equals>
			</condition>
			<!-- graph of this formula: https://www.desmos.com/calculator/yazibkyib5 where A = alternator/rated-amps -->
			<expression>
				<prod>
					<dif>
						<prod>
							<value>30.811</value>
							<log>
								<dif>
									<prod>
										<property>/engines/engine/rpm</property>
										<value>8</value>
									</prod>
									<value>1300</value>
								</dif>
							</log>
						</prod>
						<value>98.1</value>
					</dif>
					<div>
						<property>/systems/electrical/suppliers/alternator/rated-amps</property>
						<value>172</value>
					</div>
				</prod>
			</expression>
		</input>
		<output>/systems/electrical/suppliers/alternator/available-amps</output>
		<min>0</min>
		<max>/systems/electrical/suppliers/alternator/rated-amps</max>
	</filter>
	<filter>
		<name>Available alternator volts</name>
		<type>gain</type>
		<gain>0.035</gain>
		<input>/engines/engine/rpm</input>
		<output>/systems/electrical/suppliers/alternator/available-volts</output>
		<min>0</min>
		<max>28</max>
	</filter>
	
	<!-- Ground power -->
	<filter>
		<name>Available ground power amps</name>
		<type>gain</type>
		<gain>120</gain>
		<input>/controls/electric/ground-power-connected</input>
		<output>/systems/electrical/suppliers/gpu/available-amps</output>
	</filter>
	<filter>
		<name>Available ground power volts</name>
		<type>gain</type>
		<gain>28</gain>
		<input>/controls/electric/ground-power-connected</input>
		<output>/systems/electrical/suppliers/gpu/available-volts</output>
	</filter>
	
	<!-- Battery -->
	<filter>
		<name>Battery output factor based on charge</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<expression>
				<div>
					<sum>
						<pow>
							<prod>
								<dif>
									<prod>
										<value>3</value>
										<dif>
											<value>1</value>
											<property>/systems/electrical/suppliers/battery/charge-norm</property>
										</dif>
									</prod>
									<value>1</value>
								</dif>
								<value>-1</value>
							</prod>
							<value>5</value>
						</pow>
						<value>32</value>
					</sum>
					<value>32</value>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/suppliers/battery/available-power-factor</output>
	</filter>
	<filter>
		<name>Available battery volts</name>
		<type>gain</type>
		<gain>/systems/electrical/suppliers/battery/available-power-factor</gain>
		<input>24</input>
		<output>/systems/electrical/suppliers/battery/available-volts</output>
	</filter>
	<filter>
		<name>Available battery amps</name>
		<type>gain</type>
		<gain>60</gain>
		<input>/systems/electrical/suppliers/battery/available-power-factor</input>
		<output>/systems/electrical/suppliers/battery/available-amps</output>
	</filter>
	
	<!-- Then, every supplier sets it's actual voltage based on the witches -->
	<filter>
		<name>Alternator volts</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<condition>
				<and>
					<property>/controls/electric/battery-switch</property>
					<property>/controls/electric/engine[0]/master-alt</property>
					<property>/controls/electric/circuit-breakers/alt-reg</property>
				</and>
			</condition>
			<property>/systems/electrical/suppliers/alternator/available-volts</property>
		</input>
		<output>/systems/electrical/suppliers/alternator/volts</output>
	</filter>
	
	<filter>
		<name>Ground power volts</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<condition>
				<property>/controls/electric/battery-switch</property>
			</condition>
			<property>/systems/electrical/suppliers/gpu/available-volts</property>
		</input>
		<output>/systems/electrical/suppliers/gpu/volts</output>
	</filter>
	
	<filter>
		<name>Battery volts</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<condition>
				<property>/controls/electric/battery-switch</property>
			</condition>
			<property>/systems/electrical/suppliers/battery/available-volts</property>
		</input>
		<output>/systems/electrical/suppliers/battery/volts</output>
	</filter>
	
	
	<!-- Some extra work for the battery: Charge / discharge the battery based on available / needed current -->
	
	<filter>
		<name>Battery charge rate</name>
		<type>gain</type>
		<gain>/controls/electric/battery-switch</gain>
		<input>
			<expression>
				<min>
					<sum>
						<dif>
							<property>/systems/electrical/suppliers/alternator/available-amps</property>
							<property>/systems/electrical/suppliers/alternator/amps</property>
						</dif>
						<dif>
							<property>/systems/electrical/suppliers/gpu/available-amps</property>
							<property>/systems/electrical/suppliers/gpu/amps</property>
						</dif>
					</sum>
					<prod>
						<property>/systems/electrical/suppliers/battery/capacity-amp_hours</property>
						<!--simulate slower loading when battery is almost full -->
						<table>
							<property>/systems/electrical/suppliers/battery/charge-norm</property>
							<entry>
								<ind>0.75</ind>
								<dep>1</dep>
							</entry>
							<entry>
								<ind>0.8</ind>
								<dep>0.6</dep>
							</entry>
							<entry>
								<ind>0.85</ind>
								<dep>0.3</dep>
							</entry>
							<entry>
								<ind>0.9</ind>
								<dep>0.15</dep>
							</entry>
							<entry>
								<ind>0.95</ind>
								<dep>0.05</dep>
							</entry>
							<entry>
								<ind>1</ind>
								<dep>0</dep>
							</entry>
						</table>
					</prod>
				</min>
			</expression>
		</input>
		<output>/systems/electrical/suppliers/battery/charge-rate-amps</output>
	</filter>
			
	<filter>
		<name>Apply battery input / output to charge</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<condition>
				<not>
					<property>/systems/electrical/suppliers/battery/reset-to-full-charge</property>
				</not>
			</condition>
			<expression>
				<sum>
					<property>/systems/electrical/suppliers/battery/charge-amp_hours</property>
					<div>
						<prod>
							<dif>
								<property>/systems/electrical/suppliers/battery/charge-rate-amps</property>
								<property>/systems/electrical/suppliers/battery/amps</property>
							</dif>
							<property>/systems/electrical/dt</property>
						</prod>
						<value>3600</value>
					</div>
				</sum>
			</expression>
		</input>
		<!-- reset to full charge if the condition for the above input is not true -->
		<input>/systems/electrical/suppliers/battery/capacity-amp_hours</input>
		<output>/systems/electrical/suppliers/battery/charge-amp_hours</output>
		<min>0</min>
		<max>/systems/electrical/suppliers/battery/capacity-amp_hours</max>
	</filter>
	<logic>
		<name>Reset recharge flag</name>
		<inverted type="bool">true</inverted>
		<input>
			<value type="bool">true</value>
		</input>
		<output>/systems/electrical/suppliers/battery/reset-to-full-charge</output>
	</logic>
	<filter>
		<name>Battery charge normalized</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/suppliers/battery/charge-amp_hours</property>
					<property>/systems/electrical/suppliers/battery/capacity-amp_hours</property>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/suppliers/battery/charge-norm</output>
	</filter>
	<filter>
		<name>Battery charge percent</name>
		<type>gain</type>
		<gain>100</gain>
		<input>/systems/electrical/suppliers/battery/charge-norm</input>
		<output>/systems/electrical/suppliers/battery/charge-percent</output>
	</filter>
	
	<logic>
		<name>Determine if battery is supplying power</name>
		<input>
			<and>
				<not>
					<or>
						<property>/systems/electrical/suppliers/alternator/power</property>
						<property>/systems/electrical/suppliers/gpu/power</property>
					</or>
				</not>
				<greater-than>
					<property>/systems/electrical/suppliers/battery/volts</property>
					<value>12</value>
				</greater-than>
				<property>/controls/electric/battery-switch</property>
			</and>
		</input>
		<output>/systems/electrical/suppliers/battery/power</output>
	</logic>
	<logic>
		<name>Determine if alternator is supplying power</name>
		<input>
			<and>
				<not>
					<property>/systems/electrical/suppliers/gpu/power</property>
				</not>
				<greater-than>
					<property>/systems/electrical/suppliers/alternator/volts</property>
					<property>/systems/electrical/suppliers/battery/volts</property>
				</greater-than>
				<property>/controls/electric/engine/master-alt</property>
				<property>/controls/electric/battery-switch</property>
			</and>
		</input>
		<output>/systems/electrical/suppliers/alternator/power</output>
	</logic>
	<logic>
		<name>Determine if ground power receptacle is supplying power</name>
		<input>
			<and>
				<greater-than>
					<property>/systems/electrical/suppliers/gpu/volts</property>
					<expression>
						<max>
							<property>/systems/electrical/suppliers/alternator/volts</property>
							<property>/systems/electrical/suppliers/battery/volts</property>
						</max>
					</expression>
				</greater-than>
				<property>/controls/electric/ground-power-connected</property>
				<property>/controls/electric/engine/master-bat</property>
			</and>
		</input>
		<output>/systems/electrical/suppliers/gpu/power</output>
	</logic>
	
	<!-- Determine primary bus power -->
	<filter>
		<name>Primary bus volts</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<condition>
				<property>/systems/electrical/suppliers/battery/power</property>
			</condition>
			<property>/systems/electrical/suppliers/battery/volts</property>
		</input>
		<input>
			<condition>
				<property>/systems/electrical/suppliers/alternator/power</property>
			</condition>
			<property>/systems/electrical/suppliers/alternator/volts</property>
		</input>
		<input>
			<condition>
				<property>/systems/electrical/suppliers/gpu/power</property>
			</condition>
			<property>/systems/electrical/suppliers/gpu/volts</property>
		</input>
		<output>/systems/electrical/buses/primary/volts</output>
	</filter>
	<filter>
		<name>Primary bus amps</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<condition>
				<property>/systems/electrical/suppliers/battery/power</property>
			</condition>
			<property>/systems/electrical/suppliers/battery/available-amps</property>
		</input>
		<input>
			<condition>
				<property>/systems/electrical/suppliers/alternator/power</property>
			</condition>
			<property>/systems/electrical/suppliers/alternator/available-amps</property>
		</input>
		<input>
			<condition>
				<property>/systems/electrical/suppliers/gpu/power</property>
			</condition>
			<property>/systems/electrical/suppliers/gpu/available-amps</property>
		</input>
		<output>/systems/electrical/buses/primary/available-amps</output>
	</filter>
	
	<!-- Avionics bus power -->
	<filter>
		<type>gain</type>
		<gain>/controls/electric/avionics-power</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/avionics/volts</output>
	</filter>
	<filter>
		<type>gain</type>
		<gain>/controls/electric/avionics-power</gain>
		<input>/systems/electrical/buses/primary/available-amps</input>
		<output>/systems/electrical/buses/avionics/available-amps</output>
	</filter>
	
	<!-- Primary bus consumers power -->
	<filter>
		<name>Radio and instrument lights volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-instrument-lights</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/radio-instrument-lights/volts</output>
	</filter>
	<filter>
		<name>Radio and instrument lights amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-instrument-lights</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<sum>
							<prod>
								<property>/systems/electrical/buses/primary/consumers/radio-instrument-lights/post-lights-amps</property>
								<property>/controls/lighting/panel-post-norm</property>
							</prod>
							<prod>
								<sum>
									<property>/systems/electrical/buses/primary/consumers/radio-instrument-lights/engine-instrument-lights-amps</property>
									<property>/systems/electrical/buses/primary/consumers/radio-instrument-lights/digital-clock-backlight-amps</property>
									<property>/systems/electrical/buses/primary/consumers/radio-instrument-lights/compass-light-amps</property>
								</sum>
								<property>/controls/lighting/panel-integral-norm</property>
							</prod>
							<prod>
								<sum>
									<property>/systems/electrical/buses/primary/consumers/radio-instrument-lights/pedestal-lights-amps</property>
									<property>/systems/electrical/buses/primary/consumers/radio-instrument-lights/approach-plate-map-light-amps</property>
									<property>/systems/electrical/buses/primary/consumers/radio-instrument-lights/radio-lights-amps</property>
								</sum>
								<property>/controls/lighting/panel-flood-norm</property>
							</prod>
						</sum>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/radio-instrument-lights/amps</output>
	</filter>
	
	<filter>
		<name>Cabin lights volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/cabin-lights</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/cabin-lights/volts</output>
	</filter>
	<filter>
		<name>Cabin lights amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/cabin-lights</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<sum>
							<prod>
								<property>/systems/electrical/buses/primary/consumers/cabin-lights/ice-detection-light-amps</property>
								<property>/controls/lighting/ice-detection-light</property>
							</prod>
							<prod>
								<property>/systems/electrical/buses/primary/consumers/cabin-lights/dome-courtesy-baggage-lights-amps</property>
								<property>/controls/lighting/dome-courtesy-baggage-light</property>
							</prod>
							<prod>
								<property>/systems/electrical/buses/primary/consumers/cabin-lights/low-voltage-warning-light-amps</property>
								<property>/systems/electrical/low-voltage-light-norm</property>
							</prod>
							<prod>
								<property>/systems/electrical/buses/primary/consumers/cabin-lights/oxygen-lights-amps</property>
								<property>/systems/oxygen/oxygen-depleted</property>
							</prod>
							<prod>
								<property>/systems/electrical/buses/primary/consumers/cabin-lights/overhead-flood-light-amps</property>
								<property>/controls/lighting/panel-flood-norm</property>
							</prod>
							<prod>
								<property>/systems/electrical/buses/primary/consumers/cabin-lights/ignition-switch-amps</property>
								<property>/controls/engines/engine/starter</property>
							</prod>
						</sum>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/cabin-lights/amps</output>
	</filter>
	
	<filter>
		<name>Instrument flood lights volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/instrument-flood-lights</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/instrument-flood-lights/volts</output>
	</filter>
	<filter>
		<name>Instrument flood lights amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/instrument-flood-lights</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/instrument-flood-lights/glareshield-flood-lights-amps</property>
							<property>/controls/lighting/panel-flood-norm</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/instrument-flood-lights/amps</output>
	</filter>
	
	<filter>
		<name>Nav lights volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/nav-lights</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/nav-lights/volts</output>
	</filter>
	<filter>
		<name>Nav lights amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/nav-lights</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<sum>
							<prod>
								<sum>
									<property>/systems/electrical/buses/primary/consumers/nav-lights/nav-lights-amps</property>
									<property>/systems/electrical/buses/primary/consumers/nav-lights/yoke-map-light-amps</property>
								</sum>
								<property>/sim/model/lights/nav/state</property>
							</prod>
							<prod>
								<property>/systems/electrical/buses/primary/consumers/nav-lights/electroluminescent-panel-lights-amps</property>
								<property>/controls/lighting/panel-electroluminescent-norm</property>
							</prod>
						</sum>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/nav-lights/amps</output>
	</filter>
	
	<filter>
		<name>Strobe lights volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/strobe</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/strobe/volts</output>
	</filter>
	<filter>
		<name>Strobe lights amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/strobe</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/strobe/strobe-lights-amps</property>
							<property>/sim/model/lights/strobe/state</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/strobe/amps</output>
	</filter>
	
	<filter>
		<name>Beacon light volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/beacon</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/beacon/volts</output>
	</filter>
	<filter>
		<name>Beacon light amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/beacon</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/beacon/flashing-beacon-light-amps</property>
							<property>/sim/model/lights/beacon/state</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/beacon/amps</output>
	</filter>
	
	<filter>
		<name>Tail flood lights volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/tail-flood</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/tail-flood/volts</output>
	</filter>
	<filter>
		<name>Tail flood lights amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/tail-flood</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/tail-flood/tail-flood-lights-amps</property>
							<property>/sim/model/lights/tail-flood/state</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/tail-flood/amps</output>
	</filter>
	
	<filter>
		<name>Taxi light volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/taxi</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/taxi/volts</output>
	</filter>
	<filter>
		<name>Taxi lights amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/taxi</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/taxi/taxi-light-amps</property>
							<property>/sim/model/lights/taxi/state</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/taxi/amps</output>
	</filter>
	
	<filter>
		<name>Landing light volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/landing</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/landing/volts</output>
	</filter>
	<filter>
		<name>Landing light amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/landing</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/landing/landing-light-amps</property>
							<property>/sim/model/lights/landing/state</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/landing/amps</output>
	</filter>
	
	<filter>
		<name>Flaps motor volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/flaps</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/flaps/volts</output>
	</filter>
	<filter>
		<name>Flaps motor amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/flaps</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<property>/systems/electrical/buses/primary/consumers/flaps/wing-flaps-motor-amps</property>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/flaps/amps</output>
	</filter>
	
	<filter>
		<name>Vent fan volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/vent-fan</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/vent-fan/volts</output>
	</filter>
	<filter>
		<name>Vent fan amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/vent-fan</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<sum>
							<prod>
								<property>/systems/electrical/buses/primary/consumers/vent-fan/overhead-vent-fan-amps</property>
								<property>/controls/cabin-air/overhead-vent-fan</property>
							</prod>
							<prod>
								<property>/systems/electrical/buses/primary/consumers/vent-fan/air-conditioning-amps</property>
								<property>/controls/cabin-air/air-conditioning</property>
							</prod>
						</sum>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/vent-fan/amps</output>
	</filter>
	
	<filter>
		<name>Avionics fan volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/avionics-fan</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/avionics-fan/volts</output>
	</filter>
	<filter>
		<name>Avionics fan amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/avionics-fan</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/avionics-fan/avionics-cooling-fan-amps</property>
							<property>/controls/electric/avionics-power</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/avionics-fan/amps</output>
	</filter>
	
	<filter>
		<name>Wing deice volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/wing-deice</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/wing-deice/volts</output>
	</filter>
	<filter>
		<name>Wing deice amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/wing-deice</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<property>/systems/electrical/buses/primary/consumers/wing-deice/wing-deice-system-amps</property>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/wing-deice/amps</output>
	</filter>
	
	<filter>
		<name>Gear pump volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/gear-pump</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/gear-pump/volts</output>
	</filter>
	<filter>
		<name>Wing deice amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/gear-pump</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<property>/systems/electrical/buses/primary/consumers/gear-pump/gear-pump-motor-amps</property>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/gear-pump/amps</output>
	</filter>
	
	<filter>
		<name>Electric trim volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/trim</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/trim/volts</output>
	</filter>
	<filter>
		<name>Electric trim amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/trim</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/trim/electric-elevator-trim-amps</property>
							<abs>
								<prod>
									<property>/controls/flight/electric-trim-engaged</property>
									<property>/controls/flight/electric-trim-actuate</property>
								</prod>
							</abs>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/trim/amps</output>
	</filter>
	
	<filter>
		<name>Alternator control volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/alt-reg</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/alt-reg/volts</output>
	</filter>
	<filter>
		<name>Alternator control amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/alt-reg</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/alt-reg/alternator-control-unit-amps</property>
							<property>/controls/electric/engine/master-alt</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/alt-reg/amps</output>
	</filter>
	
	<filter>
		<name>Pressurization system volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/pressurization</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/pressurization/volts</output>
	</filter>
	<filter>
		<name>Pressurization system amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/pressurization</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/pressurization/pressurization-system-amps</property>
							<property>/controls/pressurization/pressurize</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/pressurization/amps</output>
	</filter>
	
	<filter>
		<name>Propeller anti-ice volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/prop-anti-ice</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/prop-anti-ice/volts</output>
	</filter>
	<filter>
		<name>Propeller anti-ice amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/prop-anti-ice</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/prop-anti-ice/propeller-anti-ice-amps</property>
							<property>/controls/anti-ice/propeller-heat</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/prop-anti-ice/amps</output>
	</filter>
	
	<filter>
		<name>Windshield anti-ice volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/windshield-anti-ice</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/windshield-anti-ice/volts</output>
	</filter>
	<filter>
		<name>Windshield anti-ice amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/windshield-anti-ice</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/windshield-anti-ice/windshield-anti-ice-amps</property>
							<property>/controls/anti-ice/window-heat</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/windshield-anti-ice/amps</output>
	</filter>
	
	<filter>
		<name>Pitot heat volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/pitot-heat</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/pitot-heat/volts</output>
	</filter>
	<filter>
		<name>Pitot heat amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/pitot-heat</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<sum>
							<prod>
								<sum>
									<property>/systems/electrical/buses/primary/consumers/pitot-heat/pitot-heat-amps</property>
									<property>/systems/electrical/buses/primary/consumers/pitot-heat/stall-warning-heat-amps</property>
								</sum>
								<property>/controls/anti-ice/pitot-heat</property>
							</prod>
							<property>/systems/electrical/buses/primary/consumers/pitot-heat/digital-clock-amps</property>
						</sum>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/pitot-heat/amps</output>
	</filter>
	
	<filter>
		<name>Fuel pump volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/fuel-pump</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/fuel-pump/volts</output>
	</filter>
	<filter>
		<name>Fuel pump amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/fuel-pump</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/primary/consumers/fuel-pump/aux-fuel-pump-amps</property>
							<div>
								<sum>
									<property>/controls/engines/engine/fuel-pump</property>
									<property>/controls/engines/engine/fuel-pump-hi</property>
								</sum>
								<value>2</value>
							</div>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/fuel-pump/amps</output>
	</filter>
	
	<filter>
		<name>Engine instruments volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/engine-instruments</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/engine-instruments/volts</output>
	</filter>
	<filter>
		<name>Engine instruments amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/engine-instruments</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<sum>
							<property>/systems/electrical/buses/primary/consumers/engine-instruments/cht-gauge-amps</property>
							<property>/systems/electrical/buses/primary/consumers/engine-instruments/oil-temp-gauge-amps</property>
						</sum>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/engine-instruments/amps</output>
	</filter>
	
	<filter>
		<name>Turn coordinator volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/turn-coordinator</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/turn-coordinator/volts</output>
	</filter>
	<filter>
		<name>Turn coordinator amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/turn-coordinator</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<sum>
							<property>/systems/electrical/buses/primary/consumers/turn-coordinator/turn-coordinator-amps</property>
							<property>/systems/electrical/buses/primary/consumers/turn-coordinator/turn-and-bank-indicator-amps</property>
						</sum>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/turn-coordinator/amps</output>
	</filter>
	
	<filter>
		<name>Fuel quantity gauges volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/fuel-quantity</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/fuel-quantity/volts</output>
	</filter>
	<filter>
		<name>Fuel quantity gauges amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/fuel-quantity</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<sum>
							<property>/systems/electrical/buses/primary/consumers/fuel-quantity/left-fuel-quantity-indicator-amps</property>
							<property>/systems/electrical/buses/primary/consumers/fuel-quantity/right-fuel-quantity-indicator-amps</property>
						</sum>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/fuel-quantity/amps</output>
	</filter>
	
	<filter>
		<name>Stall warning system volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/stall-warn</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/stall-warn/volts</output>
	</filter>
	<filter>
		<name>Stall warning system amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/stall-warn</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<property>/systems/electrical/buses/primary/consumers/stall-warn/stall-warning-system-amps</property>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/stall-warn/amps</output>
	</filter>
	
	<filter>
		<name>Landing gear system volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/landing-gear</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/buses/primary/consumers/landing-gear/volts</output>
	</filter>
	<filter>
		<name>Landing gear system amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/landing-gear</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/primary/volts</property>
					<div>
						<value>28</value>
						<sum>
							<property>/systems/electrical/buses/primary/consumers/landing-gear/landing-gear-system-amps</property>
							<prod>
								<property>/systems/electrical/buses/primary/consumers/landing-gear/gear-position-lights-amps</property>
								<max>
									<property>/sim/model/controls/gear/retracted-lamp-illumination</property>
									<property>/sim/model/controls/gear/extended-lamp-illumination</property>
								</max>
							</prod>
							<property>/systems/electrical/buses/primary/consumers/landing-gear/gear-warning-system-amps</property>
						</sum>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/consumers/landing-gear/amps</output>
	</filter>
	
	<filter>
		<name>Radio 1 volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-1</gain>
		<input>/systems/electrical/buses/avionics/volts</input>
		<output>/systems/electrical/buses/avionics/consumers/radio-1/volts</output>
	</filter>
	<filter>
		<name>Radio 1 amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-1</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/avionics/volts</property>
					<div>
						<value>28</value>
						<prod>
							<sum>
								<property>/systems/electrical/buses/avionics/consumers/radio-1/com-nav-1-amps</property>
								<property>/systems/electrical/buses/avionics/consumers/radio-1/glideslope-amps</property>
							</sum>
							<property>/instrumentation/comm[0]/power-btn</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/avionics/consumers/radio-1/amps</output>
	</filter>
	
	<filter>
		<name>Radio 2 volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-2</gain>
		<input>/systems/electrical/buses/avionics/volts</input>
		<output>/systems/electrical/buses/avionics/consumers/radio-2/volts</output>
	</filter>
	<filter>
		<name>Radio 2 amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-2</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/avionics/volts</property>
					<div>
						<value>28</value>
						<prod>
							<sum>
								<property>/systems/electrical/buses/avionics/consumers/radio-2/com-nav-2-amps</property>
								<property>/systems/electrical/buses/avionics/consumers/radio-2/rnav-amps</property>
							</sum>
							<property>/instrumentation/comm[1]/power-btn</property>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/avionics/consumers/radio-2/amps</output>
	</filter>
	
	<filter>
		<name>Radio 3 volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-3</gain>
		<input>/systems/electrical/buses/avionics/volts</input>
		<output>/systems/electrical/buses/avionics/consumers/radio-3/volts</output>
	</filter>
	<filter>
		<name>Radio 3 amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-3</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/avionics/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/avionics/consumers/radio-3/transponder-amps</property>
							<min>
								<property>/instrumentation/transponder/knob-mode</property>
								<value>1</value>
							</min>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/avionics/consumers/radio-3/amps</output>
	</filter>
	
	<filter>
		<name>Radio 4 volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-4</gain>
		<input>/systems/electrical/buses/avionics/volts</input>
		<output>/systems/electrical/buses/avionics/consumers/radio-4/volts</output>
	</filter>
	<filter>
		<name>Radio 4 amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-4</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/avionics/volts</property>
					<div>
						<value>28</value>
						<prod>
							<property>/systems/electrical/buses/avionics/consumers/radio-4/dme-amps</property>
							<min>
								<property>/instrumentation/dme/mode</property>
								<value>1</value>
							</min>
						</prod>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/avionics/consumers/radio-4/amps</output>
	</filter>
	
	<filter>
		<name>Radio 5 volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-5</gain>
		<input>/systems/electrical/buses/avionics/volts</input>
		<output>/systems/electrical/buses/avionics/consumers/radio-5/volts</output>
	</filter>
	<filter>
		<name>Radio 5 amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/radio-5</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/avionics/volts</property>
					<div>
						<value>28</value>
						<property>/systems/electrical/buses/avionics/consumers/radio-5/adf-amps</property>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/avionics/consumers/radio-5/amps</output>
	</filter>
	
	<filter>
		<name>Marker beacon volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/marker-beacon</gain>
		<input>/systems/electrical/buses/avionics/volts</input>
		<output>/systems/electrical/buses/avionics/consumers/marker-beacon/volts</output>
	</filter>
	<filter>
		<name>Marker beacon amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/marker-beacon</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/avionics/volts</property>
					<div>
						<value>28</value>
						<property>/systems/electrical/buses/avionics/consumers/marker-beacon/marker-beacon-amps</property>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/avionics/consumers/marker-beacon/amps</output>
	</filter>
	
	<filter>
		<name>Weather radar volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/wxradar</gain>
		<input>/systems/electrical/buses/avionics/volts</input>
		<output>/systems/electrical/buses/avionics/consumers/wxradar/volts</output>
	</filter>
	<filter>
		<name>Weather radar amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/wxradar</gain>
		<!-- XXX: REMOVE this line when weather radar is implemented -->
		<input>0</input>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/avionics/volts</property>
					<div>
						<value>28</value>
						<property>/systems/electrical/buses/avionics/consumers/wxradar/weather-radar-amps</property>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/avionics/consumers/wxradar/amps</output>
	</filter>
	
	<filter>
		<name>Gyro slaving system volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/gyro-slaving</gain>
		<input>/systems/electrical/buses/avionics/volts</input>
		<output>/systems/electrical/buses/avionics/consumers/gyro-slaving/volts</output>
	</filter>
	<filter>
		<name>Gyro slaving system amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/gyro-slaving</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/avionics/volts</property>
					<div>
						<value>28</value>
						<property>/systems/electrical/buses/avionics/consumers/gyro-slaving/slaved-gyros-hsi-amps</property>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/avionics/consumers/gyro-slaving/amps</output>
	</filter>
	
	<filter>
		<name>Autopilot volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/ap-control</gain>
		<input>/systems/electrical/buses/avionics/volts</input>
		<output>/systems/electrical/buses/avionics/consumers/ap-control/volts</output>
	</filter>
	<filter>
		<name>Autopilot amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/ap-control</gain>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/avionics/volts</property>
					<div>
						<value>28</value>
						<sum>
							<prod>
								<property>/systems/electrical/buses/avionics/consumers/ap-control/autopilot-amps</property>
								<property>/controls/autoflight/enabled</property>
							</prod>
							<property>/systems/electrical/buses/avionics/consumers/ap-control/ap-control-amps</property>
							<property>/systems/electrical/buses/avionics/consumers/ap-control/backcourse-light-amps</property>
						</sum>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/avionics/consumers/ap-control/amps</output>
	</filter>
	
	<filter>
		<name>Autopilot actuators volts</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/ap-actuators</gain>
		<input>/systems/electrical/buses/avionics/volts</input>
		<output>/systems/electrical/buses/avionics/consumers/ap-actuators/volts</output>
	</filter>
	<filter>
		<name>Autopilot actuators amps</name>
		<type>gain</type>
		<gain>/controls/electric/circuit-breakers/ap-actuators</gain>
		<!-- TODO: Implement actuator-is-moving property because servos only add load when moving, then remove below line -->
		<input>0</input>
		<input>
			<expression>
				<div>
					<property>/systems/electrical/buses/avionics/volts</property>
					<div>
						<value>28</value>
						<sum>
							<property>/systems/electrical/buses/avionics/consumers/ap-actuators/roll-actuator-amps</property>
							<property>/systems/electrical/buses/avionics/consumers/ap-actuators/pitch-actuator-amps</property>
						</sum>
					</div>
				</div>
			</expression>
		</input>
		<output>/systems/electrical/buses/avionics/consumers/ap-actuators/amps</output>
	</filter>
	
	<filter>
		<name>Avionics bus load</name>
		<type>gain</type>
		<gain>/controls/electric/avionics-power</gain>
		<input>
			<expression>
				<sum>
					<property>/systems/electrical/buses/avionics/consumers/radio-1/amps</property>
					<property>/systems/electrical/buses/avionics/consumers/radio-2/amps</property>
					<property>/systems/electrical/buses/avionics/consumers/radio-3/amps</property>
					<property>/systems/electrical/buses/avionics/consumers/radio-4/amps</property>
					<property>/systems/electrical/buses/avionics/consumers/radio-5/amps</property>
					<property>/systems/electrical/buses/avionics/consumers/marker-beacon/amps</property>
					<property>/systems/electrical/buses/avionics/consumers/wxradar/amps</property>
					<property>/systems/electrical/buses/avionics/consumers/gyro-slaving/amps</property>
					<property>/systems/electrical/buses/avionics/consumers/ap-control/amps</property>
					<property>/systems/electrical/buses/avionics/consumers/ap-actuators/amps</property>
				</sum>
			</expression>
		</input>
		<output>/systems/electrical/buses/avionics/amps</output>
	</filter>
	<filter>
		<name>Primary bus load</name>
		<type>gain</type>
		<gain>/controls/electric/battery-switch</gain>
		<input>
			<expression>
				<sum>
					<property>/systems/electrical/buses/primary/consumers/radio-instrument-lights/amps</property>
					<property>/systems/electrical/buses/primary/consumers/cabin-lights/amps</property>
					<property>/systems/electrical/buses/primary/consumers/instrument-flood-lights/amps</property>
					<property>/systems/electrical/buses/primary/consumers/nav-lights/amps</property>
					<property>/systems/electrical/buses/primary/consumers/strobe/amps</property>
					<property>/systems/electrical/buses/primary/consumers/beacon/amps</property>
					<property>/systems/electrical/buses/primary/consumers/tail-flood/amps</property>
					<property>/systems/electrical/buses/primary/consumers/taxi/amps</property>
					<property>/systems/electrical/buses/primary/consumers/landing/amps</property>
					<property>/systems/electrical/buses/primary/consumers/flaps/amps</property>
					<property>/systems/electrical/buses/primary/consumers/vent-fan/amps</property>
					<property>/systems/electrical/buses/primary/consumers/avionics-fan/amps</property>
					<property>/systems/electrical/buses/primary/consumers/wing-deice/amps</property>
					<property>/systems/electrical/buses/primary/consumers/gear-pump/amps</property>
					<property>/systems/electrical/buses/primary/consumers/trim/amps</property>
					<property>/systems/electrical/buses/primary/consumers/alt-reg/amps</property>
					<property>/systems/electrical/buses/primary/consumers/pressurization/amps</property>
					<property>/systems/electrical/buses/primary/consumers/prop-anti-ice/amps</property>
					<property>/systems/electrical/buses/primary/consumers/windshield-anti-ice/amps</property>
					<property>/systems/electrical/buses/primary/consumers/pitot-heat/amps</property>
					<property>/systems/electrical/buses/primary/consumers/fuel-pump/amps</property>
					<property>/systems/electrical/buses/primary/consumers/engine-instruments/amps</property>
					<property>/systems/electrical/buses/primary/consumers/turn-coordinator/amps</property>
					<property>/systems/electrical/buses/primary/consumers/fuel-quantity/amps</property>
					<property>/systems/electrical/buses/primary/consumers/stall-warning/amps</property>
					<property>/systems/electrical/buses/primary/consumers/landing-gear/amps</property>
					<property>/systems/electrical/buses/avionics/amps</property>
				</sum>
			</expression>
		</input>
		<output>/systems/electrical/buses/primary/amps</output>
	</filter>
	
	<filter>
		<name>Determine battery load</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<expression>
				<dif>
					<property>/systems/electrical/buses/primary/amps</property>
					<max>
						<prod>
							<property>/systems/electrical/suppliers/alternator/available-amps</property>
							<property>/systems/electrical/suppliers/alternator/power</property>
						</prod>
						<prod>
							<property>/systems/electrical/suppliers/gpu/available-amps</property>
							<property>/systems/electrical/suppliers/gpu/power</property>
						</prod>
					</max>
				</dif>
			</expression>
		</input>
		<output>/systems/electrical/suppliers/battery/amps</output>
		<min>0</min>
		<max>999</max>
	</filter>
	
	<filter>
		<name>Determine alternator load</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<condition>
				<property>/systems/electrical/suppliers/alternator/power</property>
			</condition>
			<expression>
				<dif>
					<sum>
						<property>/systems/electrical/buses/primary/amps</property>
						<property>/systems/electrical/suppliers/battery/charge-rate-amps</property>
					</sum>
					<prod>
						<property>/systems/electrical/suppliers/battery/amps</property>
						<property>/systems/electrical/suppliers/battery/power</property>
					</prod>
				</dif>
			</expression>
		</input>
		<output>/systems/electrical/suppliers/alternator/amps</output>
	</filter>
	
	<filter>
		<name>Determine ground power load</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<condition>
				<property>/systems/electrical/suppliers/gpu/power</property>
			</condition>
			<expression>
				<sum>
					<property>/systems/electrical/buses/primary/amps</property>
					<property>/systems/electrical/suppliers/battery/charge-rate-amps</property>
				</sum>
			</expression>
		</input>
		<output>/systems/electrical/suppliers/gpu/amps</output>
	</filter>
	
	<filter>
		<name>Ammeter battery charge / discharge rate indication</name>
		<type>noise-spike</type>
		<max-rate-of-change>10</max-rate-of-change>
		<input>
			<expression>
				<dif>
					<property>/systems/electrical/suppliers/battery/charge-rate-amps</property>
					<property>/systems/electrical/suppliers/battery/amps</property>
				</dif>
			</expression>
		</input>
		<output>/systems/electrical/ammeter-needle-amps</output>
	</filter>
	
	<logic>
		<name>Determine if we have any power</name>
		<input>
			<and>
				<or>
					<property>/systems/electrical/suppliers/battery/power</property>
					<property>/systems/electrical/suppliers/alternator/power</property>
					<property>/systems/electrical/suppliers/gpu/power</property>
				</or>
				<greater-than>
					<property>/systems/electrical/buses/primary/volts</property>
					<value>12</value>
				</greater-than>
			</and>
		</input>
	</logic>
	
	<filter>
		<name>Set generic electrical amps property</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<expression>
				<sum>
					<property>/systems/electrical/suppliers/battery/amps</property>
					<property>/systems/electrical/suppliers/alternator/amps</property>
					<property>/systems/electrical/suppliers/gpu/amps</property>
				</sum>
			</expression>
		</input>
		<output>/systems/electrical/amps</output>
	</filter>
	<filter>
		<name>Set generic electrical volts property</name>
		<type>gain</type>
		<gain>1</gain>
		<input>/systems/electrical/buses/primary/volts</input>
		<output>/systems/electrical/volts</output>
	</filter>
	
	<logic>
		<name>Determine if COM/NAV1 is powered</name>
		<input>
			<and>
				<property>/instrumentation/comm/power-btn</property>
				<greater-than>
					<property>/systems/electrical/buses/avionics/consumers/radio-1/volts</property>
					<value>12</value>
				</greater-than>
			</and>
		</input>
		<output>/instrumentation/comm/powered</output>
		<output>/instrumentation/nav/powered</output>
	</logic>
	<logic>
		<name>Determine if COM/NAV2 is powered</name>
		<input>
			<and>
				<property>/instrumentation/comm[1]/power-btn</property>
				<greater-than>
					<property>/systems/electrical/buses/avionics/consumers/radio-2/volts</property>
					<value>12</value>
				</greater-than>
			</and>
		</input>
		<output>/instrumentation/comm[1]/powered</output>
		<output>/instrumentation/nav[1]/powered</output>
		<output>/instrumentation/rnav/powered</output>
	</logic>
	<logic>
		<name>Determine if transponder is powered</name>
		<input>
			<and>
				<greater-than>
					<property>/instrumentation/transponder/inputs/knob-mode</property>
					<value>0</value>
				</greater-than>
				<greater-than>
					<property>/systems/electrical/buses/avionics/consumers/radio-3/volts</property>
					<value>12</value>
				</greater-than>
			</and>
		</input>
		<output>/instrumentation/transponder/powered</output>
	</logic>
	<logic>
		<name>Determine if DME is powered</name>
		<input>
			<and>
				<greater-than>
					<property>/instrumentation/dme/mode</property>
					<value>0</value>
				</greater-than>
				<greater-than>
					<property>/systems/electrical/buses/avionics/consumers/radio-4/volts</property>
					<value>12</value>
				</greater-than>
			</and>
		</input>
		<output>/instrumentation/dme/powered</output>
	</logic>
	<logic>
		<name>Determine if ADF is powered</name>
		<input>
			<and>
				<property>/instrumentation/adf/power-btn</property>
				<greater-than>
					<property>/systems/electrical/buses/avionics/consumers/radio-5/volts</property>
					<value>12</value>
				</greater-than>
			</and>
		</input>
		<output>/instrumentation/adf/powered</output>
	</logic>
	<logic>
		<name>Determine if gear position lights are powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/landing-gear/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/sim/model/controls/gear/powered</output>
	</logic>
	<logic>
		<name>Determine if gear pump is powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/gear-pump/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/systems/hydraulic/powered</output>
	</logic>
	<logic>
		<name>Determine if flaps are powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/flaps/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/sim/model/controls/flaps/powered</output>
	</logic>
	<logic>
		<name>Determine if autopilot control is powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/avionics/consumers/ap-control/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/autopilot/powered</output>
	</logic>
	<logic>
		<name>Determine if autopilot actuators are powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/avionics/consumers/ap-actuators/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/autopilot/actuators-powered</output>
	</logic>
	<logic>
		<name>Determine if digital clock is powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/pitot-heat/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/instrumentation/clock/powered</output>
	</logic>
	<logic>
		<name>Determine if digital clock backlight is powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/radio-instrument-lights/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/instrumentation/clock/backlight-powered</output>
	</logic>
	<logic>
		<name>Determine if flashing beacon is powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/beacon/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/sim/model/lights/beacon/powered</output>
	</logic>
	<logic>
		<name>Determine if strobe lights are powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/strobe/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/sim/model/lights/strobe/powered</output>
	</logic>
	<logic>
		<name>Determine if nav lights are powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/nav-lights/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/sim/model/lights/nav/powered</output>
	</logic>
	<logic>
		<name>Determine if tail flood lights are powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/tail-flood/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/sim/model/lights/tail-flood/powered</output>
	</logic>
	<logic>
		<name>Determine if taxi light is powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/taxi/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/sim/model/lights/taxi/powered</output>
	</logic>
	<logic>
		<name>Determine if landing light is powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/landing/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/sim/model/lights/landing/powered</output>
	</logic>
	<logic>
		<name>Determine if electric trim is powered</name>
		<input>
			<greater-than>
				<property>/systems/electrical/buses/primary/consumers/trim/volts</property>
				<value>12</value>
			</greater-than>
		</input>
		<output>/sim/model/controls/electric-trim/powered</output>
	</logic>
</PropertyList>
